# Веб-интерфейс модуля (WebUI)

::: info
Исходный код APatch был заимствован и модифицирован из KernelSU, поэтому APatch представил функцию WebUI с версии [10568](https://github.com/bmax121/APatch/releases/tag/10568) после того, как KernelSU представил функцию WebUI.
Реализация и требования к APatch WebUI полностью совпадают с KernelSU. WebUI, разработанный для модулей KernelSU, может прекрасно работать в APatch.
:::

Помимо выполнения загрузочных скриптов и изменения системных файлов, модули APatch также поддерживают отображение пользовательских интерфейсов и взаимодействие с пользователями.

Модуль может писать страницы HTML + CSS + JavaScript с помощью любой веб-технологии. Менеджер APatch будет отображать эти страницы через WebView. Он также предоставляет некоторые API для взаимодействия с системой, например, для выполнения команд оболочки.

## Каталог webroot

Файлы веб-ресурсов должны быть помещены в подкаталог `webroot` корневого каталога модуля, и там **ДОЛЖЕН** быть файл с именем `index.html`, который является страницей модуля. Простейшая структура модуля, содержащего веб-интерфейс, выглядит следующим образом:

```txt
❯ tree .
.
|-- module.prop
`-- webroot
    `-- index.html
```

:::warning
При установке модуля APatch автоматически установит права доступа и контекст SELinux для этого каталога. Если вы не знаете, что делаете, пожалуйста, не устанавливайте права доступа к этому каталогу самостоятельно!
:::

Если ваша страница содержит CSS и JavaScript, их тоже нужно поместить в эту директорию.

## JavaScript API

Если это просто страница отображения, то она ничем не отличается от обычной веб-страницы. Что еще более важно, KernelSU предоставляет ряд системных API, которые позволяют реализовать уникальные функции модуля.

KernelSU предоставляет библиотеку JavaScript и [публикует ее на npm](https://www.npmjs.com/package/kernelsu), которую вы можете использовать в JavaScript-коде ваших веб-страниц.

Например, вы можете выполнить команду оболочки, чтобы получить определенную конфигурацию или изменить свойство:

```JavaScript
import { exec } from 'kernelsu';

const { errno, stdout } = exec("getprop ro.product.model");
```

Ещё один пример, вы можете сделать веб-страницу полноэкранной или отобразить тост.

[Документация по API](https://www.npmjs.com/package/kernelsu)

Если вы обнаружите, что существующий API не удовлетворяет вашим потребностям или неудобен в использовании, вы можете высказать свои предложения [здесь](https://github.com/bmax121/APatch/issues)!

## Несколько советов

1. Вы можете использовать `localStorage` для хранения некоторых данных, но они будут потеряны после удаления приложения Manager. Если вам нужно хранить данные постоянно, вы можете сами записать их в какую-нибудь директорию.
2. Для простых страниц я рекомендую использовать [parceljs](https://parceljs.org/) для упаковки. Он не требует никаких настроек и очень удобен в использовании. Однако, если вы мастер фронтенда или у вас есть свои предпочтения, то просто выберите тот, который вам нравится!
